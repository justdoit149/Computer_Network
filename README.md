# 天气预报
## 1.实验概述
本次实验我们实现了一个简单的天气预报小程序，实现了查看本地天气情况，查询某一地区的天气，收藏某些地区的天气情况等功能。
## 2.实验内容
### 2.1.用户信息的存储
首先，我们需要一个数据库，存储每一位用户收藏的城市。用户登录小程序时，数据库会根据用户的唯一标识id查询到用户收藏的城市，供列表页面使用。同时，用户也可以在列表页面增加或删除收藏的城市。
本次基于获取用户ID以及数据库的增删改查设计了五个云函数，包括获取用户ID，初始化用户数据库，查询数据库，添加一个元素和删除元素。
数据库中信息基于数组存储，该部分涉及到云函数的相关内容，云函数的源码已经封装到util中。
1. getUserID
获取用户的维一表示ID，将ID作为每一位用户数据的标识
2. initUserData
用于初始化用户在数据库中的存储条目
3. getUserData
获取用户对应的地理位置数组
4. append
向数组的末尾增加一个元素，用于用户增加收藏的城市
5. delete
删除数组中的一个元素，用于帮助用户删除收藏的城市
### 2.2 获取用户位置
用户进入小程序后，进入到Login页面。我们在这里要获取用户的位置用于展示用户当地的天气，用户允许后直接进入到当前位置的weather页面中
### 2.3 weather页面的设计
用户将位置授权给我们后，我们就进入了weather页面,这是本次小程序比较重要的一个页面，用于查询某一位置的天气基础信息。这一功能可以分为一下几步。
1. 获取该地的天气信息
我们使用了和风天气的API，并且注册了多个key，如果用户的访问过多，超过了一个key的最大限额，我们会启用其他的key来继续访问。我们将位置信息和key一起上传后，和风天气会返回相应的天气信息。
这里我们采用了异步函数，可以同时并行，获取该地天气的各种信息，当获取完所有信息后进入下一阶段
2. 组件的运用
我们将天气分为NowPart,DayPart,WeekPart,WeatherIndices四部分。最终做成了四个组件。分别展示了当前位置的实时天气，二十四小时天气，七日天气以及详细数据。每一部分都配备有相应的onclick函数，用户想要了解某一部分的详细信息后就可以点击相应部分，进入到对应的组件，组件内部展示了天气的详细信息
3. 其他微小功能
onClickToStar函数：对应右上角的收藏，如果按钮呈现红色表示该地区已经被添加到列表页面,呈现白色表示从列表界面移除，用户可以通过点击切换该地区的天气状态
onClickToSearch函数，对应左上角的城市，点击后跳转到搜索页面，可以通过搜索城市获取其他地区的天气信息。
我们还实现了底部的导航栏，可以通过这里快速跳转到列表页面，也可以跳转回来
搜索和列表页面的实现见下方2.5，2.4
### 2.4 列表页面
通过底部的导航栏我们就可以进入到列表页面，也就是list页面，页面最上方是搜索按钮，通过这里我们可以跳转到搜索页面，然后我们设置了一个cityitem的组件，展示用户收藏的城市，点击城市就可以跳转到该城市的详细天气信息，并且可以决定是否将其加入到列表页面里
### 2.5 搜索页面
我们的搜素页面采用调用和风天气的搜索功能，进行模糊搜索，如果用户输入了准确的地理位置，系统将提供给对应地区的天气；如果用户输入了一个模糊的地理位置，系统将会匹配到一个相近的地理位置的信息；如果该地区系统没有相关的天气信息，系统会返回“抱歉，暂时没有你查询的地区的天气信息“；如果找不到该地区，系统会返回“查询的地区不存在，请规范输入后重试”，其他错误情况系统也会有相应的返回语句。